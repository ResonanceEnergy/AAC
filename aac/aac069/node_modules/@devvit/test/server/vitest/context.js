import { AsyncLocalStorage } from 'node:async_hooks';
import {} from '@devvit/shared-types/shared/devvit-worker-global.js';
const contextStorage = new AsyncLocalStorage();
export function runWithTestContext(context, fn) {
    return contextStorage.run(context, fn);
}
export function getTestContext() {
    return contextStorage.getStore();
}
class TestDevvitWorkerGlobal {
    constructor() {
        this.compute = { platform: 'node' };
    }
    get config() {
        return getTestContext()?.config;
    }
    get appConfig() {
        return getTestContext()?.appConfig;
    }
}
export function installDevvitInterceptors() {
    if (globalThis.devvit instanceof TestDevvitWorkerGlobal)
        return;
    globalThis.devvit = new TestDevvitWorkerGlobal();
}
